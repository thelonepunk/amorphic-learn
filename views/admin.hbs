<div class="admin-page">
    <h1>Admin</h1>
    
    <div class="admin-grid">
        <section class="admin-section">
            <h2>Courses</h2>
            <table class="admin-table">
                <tr><th>Title</th><th>Slug</th><th>Lessons</th><th>Actions</th></tr>
                {{#each courses}}
                <tr>
                    <td>{{this.title}}</td>
                    <td><code>{{this.slug}}</code></td>
                    <td>{{this.lesson_count}}</td>
                    <td>
                        <button onclick="showEditCourse({{this.id}}, '{{this.title}}', '{{this.slug}}', '{{this.description}}', '{{this.thumbnail}}')" class="btn btn-sm btn-secondary">Edit</button>
                        <form method="POST" action="/admin/course/delete" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this course and all its lessons?')">
                            <input type="hidden" name="id" value="{{this.id}}">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {{/each}}
            </table>
            
            <!-- Edit Course Form (hidden by default) -->
            <div id="edit-course-form" style="display:none;">
                <h3>Edit Course</h3>
                <form method="POST" action="/admin/course/update" class="admin-form">
                    <input type="hidden" name="id" id="edit-course-id">
                    <input id="edit-course-title" name="title" placeholder="Course title" required>
                    <input id="edit-course-slug" name="slug" placeholder="url-slug" required>
                    <input id="edit-course-description" name="description" placeholder="Description">
                    <input id="edit-course-thumbnail" name="thumbnail" placeholder="Thumbnail URL (optional)">
                    <button type="submit" class="btn btn-primary">Update Course</button>
                    <button type="button" onclick="hideEditCourse()" class="btn btn-secondary">Cancel</button>
                </form>
            </div>
            
            <h3>Add Course</h3>
            <form method="POST" action="/admin/course" class="admin-form">
                <input name="title" placeholder="Course title" required>
                <input name="slug" placeholder="url-slug" required>
                <input name="description" placeholder="Description">
                <input name="thumbnail" placeholder="Thumbnail URL (optional)">
                <button type="submit" class="btn btn-primary">Add Course</button>
            </form>
        </section>
        
        <section class="admin-section">
            <h2>Lessons</h2>
            <table class="admin-table">
                <tr><th>Course</th><th>Title</th><th>Slug</th><th>Duration</th><th>Actions</th></tr>
                {{#each courses}}
                    {{#each (lookup ../lessons this.id)}}
                    <tr>
                        <td>{{../title}}</td>
                        <td>{{this.title}}</td>
                        <td><code>{{this.slug}}</code></td>
                        <td>{{this.duration}}s</td>
                        <td>
                            <button onclick="showEditLesson({{this.id}}, {{this.course_id}}, '{{this.title}}', '{{this.slug}}', '{{this.description}}', '{{this.video_url}}', {{this.duration}}, {{this.sort_order}}, `{{this.content}}`)" class="btn btn-sm btn-secondary">Edit</button>
                            <form method="POST" action="/admin/lesson/delete" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this lesson?')">
                                <input type="hidden" name="id" value="{{this.id}}">
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {{/each}}
                {{/each}}
            </table>
            
            <!-- Edit Lesson Form (hidden by default) -->
            <div id="edit-lesson-form" style="display:none;">
                <h3>Edit Lesson</h3>
                <form method="POST" action="/admin/lesson/update" class="admin-form" enctype="multipart/form-data">
                    <input type="hidden" name="id" id="edit-lesson-id">
                    <select name="course_id" id="edit-lesson-course-id" required>
                        <option value="">Select course...</option>
                        {{#each courses}}
                        <option value="{{this.id}}">{{this.title}}</option>
                        {{/each}}
                    </select>
                    <input id="edit-lesson-title" name="title" placeholder="Lesson title" required>
                    <input id="edit-lesson-slug" name="slug" placeholder="url-slug" required>
                    <input id="edit-lesson-description" name="description" placeholder="Description">
                    <input type="file" name="video_file" accept="video/*" placeholder="Upload video file">
                    <input id="edit-lesson-video-url" name="video_url" placeholder="Or enter video URL">
                    <small>Upload MP4 file OR enter URL (upload takes precedence)</small>
                    <input id="edit-lesson-duration" name="duration" type="number" placeholder="Duration (seconds)">
                    <input id="edit-lesson-sort-order" name="sort_order" type="number" placeholder="Sort order">
                    <textarea id="edit-lesson-content" name="content" placeholder="Lesson content (HTML)" rows="4"></textarea>
                    <button type="submit" class="btn btn-primary">Update Lesson</button>
                    <button type="button" onclick="hideEditLesson()" class="btn btn-secondary">Cancel</button>
                </form>
            </div>
            
            <h3>Add Lesson</h3>
            <form method="POST" action="/admin/lesson" class="admin-form" enctype="multipart/form-data">
                <select name="course_id" required>
                    <option value="">Select course...</option>
                    {{#each courses}}
                    <option value="{{this.id}}">{{this.title}}</option>
                    {{/each}}
                </select>
                <input name="title" placeholder="Lesson title" required>
                <input name="slug" placeholder="url-slug" required>
                <input name="description" placeholder="Description">
                <input type="file" name="video_file" accept="video/*" placeholder="Upload video file">
                <input name="video_url" placeholder="Or enter video URL">
                <small>Upload MP4 file OR enter URL (upload takes precedence)</small>
                <input name="duration" type="number" placeholder="Duration (seconds)">
                <input name="sort_order" type="number" placeholder="Sort order" value="0">
                <textarea name="content" placeholder="Lesson content (HTML)" rows="4"></textarea>
                <button type="submit" class="btn btn-primary">Add Lesson</button>
            </form>
        </section>
        
        <section class="admin-section">
            <h2>Users</h2>
            <table class="admin-table">
                <tr><th>Name</th><th>Email</th><th>Role</th></tr>
                {{#each users}}
                <tr>
                    <td>{{this.name}}</td>
                    <td>{{this.email}}</td>
                    <td>{{this.role}}</td>
                    <td>
                        <form method="POST" action="/admin/user/delete" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this user?')">
                            <input type="hidden" name="id" value="{{this.id}}">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {{/each}}
            </table>
            <h3>Add User</h3>
            <form method="POST" action="/admin/user" class="admin-form">
                <input name="name" placeholder="Full name" required>
                <input name="email" type="email" placeholder="Email" required>
                <input name="password" placeholder="Password" required>
                <select name="role">
                    <option value="student">Student</option>
                    <option value="admin">Admin</option>
                </select>
                <button type="submit" class="btn btn-primary">Add User</button>
            </form>
        </section>
    </div>
</div>

<script>
function showEditCourse(id, title, slug, description, thumbnail) {
    document.getElementById('edit-course-id').value = id;
    document.getElementById('edit-course-title').value = title;
    document.getElementById('edit-course-slug').value = slug;
    document.getElementById('edit-course-description').value = description || '';
    document.getElementById('edit-course-thumbnail').value = thumbnail || '';
    document.getElementById('edit-course-form').style.display = 'block';
    
    // Scroll to the edit form
    document.getElementById('edit-course-form').scrollIntoView({ behavior: 'smooth' });
}

function hideEditCourse() {
    document.getElementById('edit-course-form').style.display = 'none';
}

function showEditLesson(id, courseId, title, slug, description, videoUrl, duration, sortOrder, content) {
    document.getElementById('edit-lesson-id').value = id;
    document.getElementById('edit-lesson-course-id').value = courseId;
    document.getElementById('edit-lesson-title').value = title;
    document.getElementById('edit-lesson-slug').value = slug;
    document.getElementById('edit-lesson-description').value = description || '';
    document.getElementById('edit-lesson-video-url').value = videoUrl || '';
    document.getElementById('edit-lesson-duration').value = duration || '';
    document.getElementById('edit-lesson-sort-order').value = sortOrder || '';
    document.getElementById('edit-lesson-content').value = content || '';
    document.getElementById('edit-lesson-form').style.display = 'block';
    
    // Scroll to the edit form
    document.getElementById('edit-lesson-form').scrollIntoView({ behavior: 'smooth' });
}

function hideEditLesson() {
    document.getElementById('edit-lesson-form').style.display = 'none';
}
</script>
